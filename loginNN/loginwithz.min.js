"use strict";

function b64Uri(a) {
    return btoa(a).replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/, "")
}

function getPkce(a, b) {
    a = a || 43;
    for (var c = window.msCrypto || window.crypto, d = b64Uri(Array.prototype.map.call(c.getRandomValues(new Uint8Array(a)), function(a) {
        return String.fromCharCode(a)
    }).join("")).substring(0, a), e = new Uint8Array(d.length), f = 0; f < d.length; f++) e[f] = d.charCodeAt(f);
    var g = c.subtle.digest("SHA-256", e);
    window.CryptoOperation ? (g.onerror = b, g.oncomplete = function(a) {
        runCallback(b, d, a.target.result)
    }) : g.then(function(a) {
        runCallback(b, d, a)
    }).catch(b)
}

function runCallback(a, b, c) {
    a(null, {
        verifier: b,
        challenge: b64Uri(String.fromCharCode.apply(null, new Uint8Array(c)))
    })
}
var loginwithz = function() {
    function a(a) {
        return a.toString(16).padStart(2, "0")
    }

    function b() {
        var a = (screen.width - 600) / 2,
            b = (screen.height - 600) / 4,
            c = "popup,left=" + a + ",top=" + b + ",width=600,height=600",
            e = j + "/auth/?response_type=code&client_id=" + f + "&state=" + i + "&scope=" + h + "&code_challenge=" + l + "&code_challenge_method=S256";
        d = window.open(e, "loginwithz", c)
    }

    function c(a) {
        "function" == typeof g && (null == m ? g(i, null, null, a) : g(i, m, k, a))
    }
    var d, e, f, g, h = "profile",
        i = function(b) {
            var c = new Uint8Array((b || 40) / 2);
            return window.crypto.getRandomValues(c), Array.from(c, a).join("")
        }(64),
        j = "https://www.newbienudes.com",
        k = "",
        l = "",
        m = null;
    return {
        init: function(a) {
            for (var d in a)
                if (a.hasOwnProperty(d)) switch (d) {
                    case "buttonId":
                        e = a[d];
                        break;
                    case "clientId":
                        f = a[d];
                        break;
                    case "scope":
                        h = a[d];
                        break;
                    case "state":
                        i = a[d];
                        break;
                    case "siteUrl":
                        j = a[d], j.indexOf("http") < 0 && (j = "https://" + j);
                        break;
                    case "handler":
                        g = a[d]
                }
            document.getElementById(e).disabled = !0, getPkce(43, function(a, d) {
                var f = d.verifier,
                    g = d.challenge;
                a || (k = f, l = g, document.getElementById(e).disabled = !1, window.addEventListener("message", function(a) {
                    a.origin.indexOf(j) < 0 || (m = a.data, c("OK"))
                }, !1), document.getElementById(e).addEventListener("click", b))
            })
        }
    }
}();
//# sourceMappingURL=loginwithz.min.js.map
export {
    loginwithz
};
//# sourceMappingURL=loginwithz.min.js.map